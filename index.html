<!DOCTYPE html>

<html>
  <head>
    <title>Calculadora</title>
    <link rel="stylesheet" type="text/css" href="assets/calc_style.css" />
    <script language="JavaScript" src="code.js" type="text/javascript"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap"
      rel="stylesheet"
    />
    <link rel="icon" type="image/png" href="assets/favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  </head>
  <body>
    <div id="calculator">
      <h1>Calculadora</h1>
      <p id="last_operation_history"></p>
      <p id="box" class="box">0</p>
      <table id="table">
        <tr>
          <td><button onclick="calculate_percentage()">%</button></td>
          <td><button onclick="clear_entry()">CE</button></td>
          <td><button onclick="button_clear()">C</button></td>
          <td>
            <button id="backspace_btn" onclick="backspace_remove()"></button>
          </td>
        </tr>
        <tr>
          <td><button onclick="division_one()">¬π‚àï‚Çì</button></td>
          <td><button onclick="power_of()">ùë•¬≤</button></td>
          <td><button onclick="square_root()">‚àöùë•</button></td>
          <td>
            <button
              id="plusOp"
              value="+"
              class="operator"
              onclick="button_number('+')"
            >
              +
            </button>
          </td>
        </tr>
        <tr>
          <td><button onclick="button_number(7)">7</button></td>
          <td><button onclick="button_number(8)">8</button></td>
          <td><button onclick="button_number(9)">9</button></td>
          <td>
            <button
              id="subOp"
              value="-"
              class="operator"
              onclick="button_number('-')"
            >
              -
            </button>
          </td>
        </tr>
        <tr>
          <td><button onclick="button_number(4)">4</button></td>
          <td><button onclick="button_number(5)">5</button></td>
          <td><button onclick="button_number(6)">6</button></td>
          <td>
            <button
              id="multiOp"
              value="*"
              class="operator"
              onclick="button_number('*')"
            >
              √ó
            </button>
          </td>
        </tr>
        <tr>
          <td><button onclick="button_number(1)">1</button></td>
          <td><button onclick="button_number(2)">2</button></td>
          <td><button onclick="button_number(3)">3</button></td>
          <td>
            <button
              id="divOp"
              value="/"
              class="operator"
              onclick="button_number('/')"
            >
              √∑
            </button>
          </td>
        </tr>
        <tr>
          <td><button onclick="plus_minus()">¬±</button></td>
          <td><button onclick="button_number(0)">0</button></td>
          <td>
            <button id="dot" value="." onclick="button_number('.')">.</button>
          </td>
          <td colspan="4">
            <button
              value="="
              class="operator"
              id="equal_sign"
              onclick="button_number('=')"
            >
              =
            </button>
          </td>
        </tr>
      </table>
    </div>
    <div class="resultado-lexico">Resultado L√©xico</div>
    <div class="arbol-derivacion">
      <p>√Årbol de Derivaci√≥n:</p>
      <div id="tree"></div>
    </div>
  </body>
  <script>
    // Definici√≥n de la clase Node
    class Node {
      constructor(value) {
        this.value = value;
        this.left = null;
        this.right = null;
      }
    }

    // Funci√≥n para construir el √°rbol de derivaci√≥n
    function buildDerivationTree(expression) {
      let stack = [];
      let operators = ["+", "-", "*", "/"];
      let operand = "";

      for (let i = 0; i < expression.length; i++) {
        let character = expression[i];
        if (operators.includes(character)) {
          if (operand !== "") {
            stack.push(new Node(parseInt(operand))); // Agrega el operando a la pila
            operand = ""; // Reinicia el operando
          }
          // Agrega el operador a la pila
          stack.push(new Node(character));
        } else {
          // Construye el operando
          operand += character;
        }
      }

      // Agrega el √∫ltimo operando a la pila si existe
      if (operand !== "") {
        stack.push(new Node(parseInt(operand)));
      }

      // Construye el √°rbol recursivamente desde la pila
      while (stack.length > 1) {
        let right = stack.pop();
        let operator = stack.pop();
        let left = stack.pop();
        operator.left = left;
        operator.right = right;
        stack.push(operator);
      }

      return stack[0]; // Retorna el nodo ra√≠z del √°rbol
    }

    // Funci√≥n para imprimir el √°rbol de derivaci√≥n
    function printDerivationTree(node, element) {
      element.innerHTML = ""; // Vac√≠a el contenido del elemento antes de agregar los nodos del √°rbol

      if (node == null) return;

      // Llama recursivamente a la funci√≥n para imprimir los nodos del √°rbol
      printNode(node, element);

      // Funci√≥n recursiva para imprimir los nodos del √°rbol
      function printNode(node, element) {
        // Crea un elemento div para representar el nodo
        let nodeElement = document.createElement("div");
        nodeElement.className = "tree-node";
        nodeElement.textContent =
          node.value instanceof Node ? node.value.value : node.value;

        if (node.left != null) {
          nodeElement.classList.add("operators");
        }

        // Agrega el elemento del nodo al contenedor
        element.appendChild(nodeElement);

        // Si el nodo tiene hijos, crea un elemento div para representar la rama del √°rbol
        if (node.left !== null || node.right !== null) {
          let branchElement = document.createElement("div");
          branchElement.className = "tree-branch";
          element.appendChild(branchElement);

          // Si el nodo tiene un hijo izquierdo, imprime el hijo izquierdo
          if (node.left !== null) {
            printNode(node.left, element);
            let leftNode = element.lastChild;
            leftNode.classList.add("node-left");
          }

          // Si el nodo tiene un hijo derecho, imprime el hijo derecho
          if (node.right !== null) {
            printNode(node.right, element);
            let rightNode = element.lastChild;
            rightNode.classList.add("node-right");
          }
        }
      }
    }

    window.onload = function () {
      let expression = prompt(
        "Ingrese la expresi√≥n para el √°rbol de derivaci√≥n:",
        "8+2"
      );
      let tree = buildDerivationTree(expression);
      let treeElement = document.getElementById("tree");
      printDerivationTree(tree, treeElement);
    };
  </script>
</html>
